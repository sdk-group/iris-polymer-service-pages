<link rel="import" href="../../bower_components/polymer/polymer.html">

<link rel="import" href="../../bower_components/paper-button/paper-button.html">
<link rel="import" href="../../bower_components/iron-icons/iron-icons.html">
<link rel="import" href="../../bower_components/iron-icon/iron-icon.html">

<link rel="import" href="iris-pagination-control.html">

<dom-module id="iris-service-pages">
  <template>
    <style include="shared-styles"></style>
    <style>
      :host {
        display: block;
      }
    </style>
    <template is="dom-repeat" items="{{getPage(pages,currentPage,currentGroup)}}">
      <paper-button raised on-click="buttonAction">
        {{item.label}}
      </paper-button>
    </template>

    <div class="service-pagination-controll">
      <paper-button raised on-click="paginationBack" hidden$="{{!canGoBack(pages,currentGroup)}}">
        Назад
      </paper-button>
      <iris-pagination-control current-page="{{currentPage}}" current-group="{{currentGroup}}" numbers="[[numbers]]" pages="[[pages]]"></iris-pagination-control>
    </div>
  </template>

  <script>
    'use strict';
    //@NOTE: test only
    let temp = {
      root: [
        [{
          type: 'service',
          label: 'Сервис 1',
          id: '111'
        }, {
          type: 'group',
          label: 'Группа 1',
          id: 'group1'
        }],
        [{
          type: 'service',
          label: 'Сервис 2',
          id: '111'
        }, {
          type: 'service',
          label: 'Сервис 3',
          id: '2222'
        }]
      ],
      group1: [
        [{
          type: 'service',
          label: 'Сервис 4',
          id: '111'
        }, {
          type: 'service',
          label: 'Сервис 5',
          id: '111'
        }],
        [{
          type: 'service',
          label: 'Сервис 6',
          id: '111'
        }],
        [{
          type: 'group',
          label: 'Гурппа 2',
          id: 'group2'
        }]
      ],
      group2: [
        [{
          type: 'service',
          label: 'Сервис 7',
          id: '111'
        }, {
          type: 'service',
          label: 'Сервис 8',
          id: '111'
        }]
      ]
    };

    (function() {
      Polymer({
        is: 'iris-service-pages',
        properties: {
          pages: {
            type: Object,
            value: {}
          },
          currentPage: {
            type: Number,
            value: 0
          },
          currentGroup: {
            type: String,
            value: 'root'
          },
          numbers: {
            type: Boolean,
            value: true
          }
        },
        ready() {
          this.path = [];
          this.set('pages', temp);
        },
        getPage(pages, number, group) {
          return _.isEmpty(pages) ? [] : pages[group][number];
        },
        buttonAction(e) {
          let model = e.model;
          let type = model.item.type || 'service';

          if ('group' === type) {
            this.path.push({
              page: this.currentPage,
              group: this.currentGroup
            });

            this.set('currentGroup', model.item.id);
            this.set('currentPage', 0);
          } else {
            this.fire('service-select', model.item.id);
          }
        },
        canGoBack(pages, group) {
          return group !== 'root';
        },
        paginationBack() {
          let back = this.path.pop();
          this.set('currentGroup', back.group);
          this.set('currentPage', back.page);
        }
      });
    })();
  </script>

</dom-module>