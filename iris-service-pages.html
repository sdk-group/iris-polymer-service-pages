<link rel="import" href="../../bower_components/polymer/polymer.html">

<link rel="import" href="../../bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="../../bower_components/iron-icons/iron-icons.html">
<link rel="import" href="../../bower_components/iron-icon/iron-icon.html">

<link rel="import" href="iris-pagination-control.html">

<dom-module id="iris-service-pages">
  <template>
    <style include="shared-styles"></style>
    <style>
      :host {
        display: block;
        height: 100%;
      }
      
      .button-container {
        display: flex;
        justify-content: space-between;
        flex-wrap: wrap;
        height: 80%;
      }
      
      .service-pagination-controll {
        position: relative;
        flex-direction: row;
        height: 10%;
        display: flex;
        justify-content: center;
      }
      
      .button-container paper-button {
        width: 32%;
        margin-bottom: 15px;
        display: flex;
        align-items: center;
        justify-content: center;
        text-transform: none;
        font-size: 20px;
      }
      
      .service-pagination-controll iris-pagination-control {
        display: flex;
        justify-content: center;
      }
      
      .service-pagination-controll paper-icon-button.back {
        position: absolute;
        right: 0;
        border-radius: 15px;
      }
      
      .service-pagination-controll paper-icon-button {
        height: 100px;
        width: 100px;
      }
      
      .service-pagination-controll paper-icon-button.back,
      .service-pagination-controll::content paper-icon-button {
        border: 3px solid;
      }
      
      .service-pagination-controll::content paper-icon-button {
        height: 100px;
        width: 100px;
        border-radius: 50%;
      }
    </style>
    <div class="button-container">
      <template is="dom-repeat" items="{{getPage(pages,currentPage,currentGroup)}}">
        <paper-button raised on-click="buttonAction">
          {{item.label}}
        </paper-button>
      </template>
    </div>

    <div class="service-pagination-controll">
      <iris-pagination-control current-page="{{currentPage}}" current-group="{{currentGroup}}" numbers="[[numbers]]" pages="[[pages]]"></iris-pagination-control>
      <paper-icon-button icon="subdirectory-arrow-left" class="back" on-click="paginationBack" disabled$="{{!canGoBack(pages,currentGroup)}}"> </paper-icon-button>
    </div>
  </template>

  <script>
    'use strict';
    //@NOTE: test only

    let temp = {
      root: [
        [{
          type: 'service',
          label: 'Выдача результатов',
          id: '1'
        }, {
          type: 'service',
          label: 'Гражданство',
          id: '2'
        }, {
          type: 'service',
          label: 'Здравоохранение',
          id: '3'
        }, {
          type: 'service',
          label: 'Земельно-имущественные отношения',
          id: '4'
        }, {
          type: 'service',
          label: 'Культура и искусство',
          id: '5'
        }, {
          type: 'service',
          label: 'Налоги и сборы (штрафы)',
          id: '6'
        }, {
          type: 'service',
          label: 'Образование',
          id: '6'
        }, {
          type: 'service',
          label: 'Производство и торговля',
          id: '7'
        }, {
          type: 'service',
          label: 'Семья',
          id: '8'
        }, {
          type: 'service',
          label: 'Социальное обеспечение',
          id: '9'
        }, {
          type: 'service',
          label: 'Спорт и туризм',
          id: '10'
        }, {
          type: 'service',
          label: 'Транспорт и связь',
          id: '11'
        }, {
          type: 'service',
          label: 'Труд и занятость',
          id: '12'
        }, {
          type: 'service',
          label: 'Экология',
          id: '13'
        }, {
          type: 'group',
          label: 'Прочее',
          id: 'other'
        }],
        [{
          type: 'service',
          label: 'Лень и прокастинация',
          id: '15'
        }, {
          type: 'service',
          label: 'Загрязнение',
          id: '16'
        }, {
          type: 'service',
          label: 'Алкоголизм и домоседство',
          id: '17'
        }, {
          type: 'service',
          label: 'Суровое выживание',
          id: '18'
        }, {
          type: 'service',
          label: 'Тлен и безысходность',
          id: '19'
        }, {
          type: 'service',
          label: 'Ад и погибель',
          id: '20'
        }, {
          type: 'service',
          label: 'Одиночество',
          id: '21'
        }]
      ],
      other: [
        [{
          type: 'service',
          label: 'Продажа бесссмертной души',
          id: '14'
        }]
      ]
    };

    (function() {
      Polymer({
        is: 'iris-service-pages',
        properties: {
          pages: {
            type: Object,
            value: {}
          },
          currentPage: {
            type: Number,
            value: 0
          },
          currentGroup: {
            type: String,
            value: 'root'
          },
          numbers: {
            type: Boolean,
            value: false
          }
        },
        ready() {
          this.path = [];
          this.set('pages', temp);
        },
        getPage(pages, number, group) {
          return _.isEmpty(pages) ? [] : pages[group][number];
        },
        buttonAction(e) {
          let model = e.model;
          let type = model.item.type || 'service';

          if ('group' === type) {
            this.path.push({
              page: this.currentPage,
              group: this.currentGroup
            });

            this.set('currentGroup', model.item.id);
            this.set('currentPage', 0);
          } else {
            this.fire('service-select', model.item.id);
          }
        },
        canGoBack(pages, group) {
          return group !== 'root';
        },
        paginationBack() {
          let back = this.path.pop();
          this.set('currentGroup', back.group);
          this.set('currentPage', back.page);
        }
      });
    })();
  </script>

</dom-module>