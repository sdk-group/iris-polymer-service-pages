<link rel="import" href="../../bower_components/polymer/polymer.html">

<link rel="import" href="../../bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="../../bower_components/paper-button/paper-button.html">
<link rel="import" href="../../bower_components/paper-checkbox/paper-checkbox.html">
<link rel="import" href="../../bower_components/iron-icons/iron-icons.html">
<link rel="import" href="../../bower_components/iron-icon/iron-icon.html">

<link rel="import" href="iris-pagination-control.html">
<link rel="import" href="../../bower_components/iris-polymer-iconset/iris-iconset.html">

<dom-module id="iris-service-pages">
  <template>
    <style include="shared-styles"></style>
    <style>
      :host {
        @apply(--layout-vertical);
        @apply(--layout-flex);
      }
      
      .button-container {
        @apply(--layout-horizontal);
        @apply(--layout-flex);
        @apply(--layout-justified);
        @apply(--layout-wrap);
      }
      
      iris-pagination-control {
        height: 100px;
      }
      
      .button-container paper-button {
        width: 32%;
        margin-bottom: 15px;
        display: flex;
        align-items: center;
        justify-content: center;
        text-transform: none;
        @apply(--service-button);
        margin-left: 0;
        margin-right: 0;
      }
      
      .button-container paper-checkbox {
        width: 45%;
        margin-bottom: 15px;
        display: flex;
        align-items: center;
        text-transform: none;
        @apply(--service-checkbox);
      }
    </style>


    <div class="button-container">
      <template is="dom-repeat" items="{{getPage(pages,currentPage,currentGroup)}}">
        <template is="dom-if" if="[[!isService(item)]]">
          <paper-button raised on-click="groupAction"> [[item.service_group_label]] </paper-button>
        </template>
        <template is="dom-if" if="[[isService(item)]]">
          <paper-checkbox class="red" on-click="serviceAction">[[item.service_label]]</paper-checkbox>
        </template>
      </template>
    </div>

    <iris-pagination-control id="pagination" current-page="{{currentPage}}" current-group="{{currentGroup}}" numbers="[[numbers]]" pages="[[pages]]"></iris-pagination-control>
  </template>

  <script>
    'use strict';


    (function() {
      Polymer({
        is: 'iris-service-pages',
        properties: {
          pages: {
            type: Object,
            value: {}
          },
          currentPage: {
            type: Number,
            notify: true,
            value: 0
          },
          currentGroup: {
            type: String,
            notify: true,
            value: 'root'
          },
          numbers: {
            type: Boolean,
            value: false
          }
        },
        getPage(pages, number, group) {
          return _.isEmpty(pages) ? [] : pages[group][number];
        },
        groupAction(e) {
          let model = e.model;
          this.$.pagination.levelDown(model.item);
        },
        serviceAction(e) {
          let model = e.model;
          this.fire('service-select', e.model.item.id);
        },
        isService(item) {
          return item.ldtype === 'Service'
        },
        reset() {
          _.forEach(this.querySelectorAll('paper-checkbox'), (cb) => cb.removeAttribute('checked'));
          this.$.pagination.reset();
        }
      });
    })();
  </script>

</dom-module>