<link rel="import" href="../../bower_components/polymer/polymer.html">

<link rel="import" href="../../bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="../../bower_components/paper-button/paper-button.html">
<link rel="import" href="../../bower_components/paper-checkbox/paper-checkbox.html">
<link rel="import" href="../../bower_components/iron-icons/iron-icons.html">
<link rel="import" href="../../bower_components/iron-icon/iron-icon.html">

<link rel="import" href="iris-pagination-control.html">
<link rel="import" href="../../bower_components/iris-polymer-iconset/iris-iconset.html">

<dom-module id="iris-service-pages">
  <template>
    <style include="shared-styles"></style>
    <style>
      :host {
        @apply(--layout-vertical);
        @apply(--layout-flex);
      }
      
      .button-container {
        @apply(--layout-horizontal);
        @apply(--layout-flex);
        @apply(--layout-justified);
        @apply(--layout-wrap);
      }
      
      .service-pagination-controll {
        position: relative;
        flex-direction: row;
        height: 100px;
        display: flex;
        justify-content: center;
      }
      
      .button-container paper-button {
        width: 32%;
        margin-bottom: 15px;
        display: flex;
        align-items: center;
        justify-content: center;
        text-transform: none;
        @apply(--service-button);
      }
      
      .service-pagination-controll iris-pagination-control {
        display: flex;
        justify-content: center;
      }
      
      .service-pagination-controll paper-icon-button[disabled] {
        @apply(--pagination-icon-buttons-disabled);
      }
      
      .service-pagination-controll paper-icon-button {
        @apply(--pagination-icon-buttons);
      }
      
      .service-pagination-controll paper-icon-button#back {
        position: absolute;
        right: 0;
        @apply(--pagination-icon-button-back);
      }
      
      .button-container paper-checkbox {
        width: 45%;
        margin-bottom: 15px;
        display: flex;
        align-items: center;
        text-transform: none;
        @apply(--service-checkbox);
      }
    </style>


    <div class="button-container">
      <template is="dom-repeat" items="{{getPage(pages,currentPage,currentGroup)}}">

        <template is="dom-if" if="{{!item.is_service}}">
          <paper-button raised on-click="groupAction"> {{item.label}} </paper-button>
        </template>
        <template is="dom-if" if="{{item.is_service}}">
          <paper-checkbox class="red" on-click="serviceAction">{{item.label}}</paper-checkbox>
        </template>
      </template>
    </div>

    <footer class="service-pagination-controll">
      <iris-pagination-control current-page="{{currentPage}}" current-group="{{currentGroup}}" numbers="[[numbers]]" pages="[[pages]]"></iris-pagination-control>
      <paper-icon-button icon="home" id="back" on-click="paginationBack" disabled$="{{!canGoBack(pages,currentGroup)}}"> </paper-icon-button>
    </footer>
  </template>

  <script>
    'use strict';


    (function() {
      Polymer({
        is: 'iris-service-pages',
        properties: {
          pages: {
            type: Object,
            value: {}
          },
          currentPage: {
            type: Number,
            notify: true,
            value: 0
          },
          currentGroup: {
            type: String,
            notify: true,
            value: 'root'
          },
          numbers: {
            type: Boolean,
            value: false
          }
        },
        ready() {
          this.path = [];
        },
        getPage(pages, number, group) {
          return _.isEmpty(pages) ? [] : pages[group][number];
        },
        groupAction(e) {
          let model = e.model;

          this.path.push({
            page: this.currentPage,
            group: this.currentGroup
          });

          this.set('currentGroup', model.item.id);
          this.set('currentPage', 0);
        },
        serviceAction(e) {
          let model = e.model;
          this.fire('service-select', model.item.id);
        },
        canGoBack(pages, group) {
          return group !== 'root';
        },
        paginationBack() {
          let back = this.path.pop();
          this.set('currentGroup', back.group);
          this.set('currentPage', back.page);
        },
        reset() {
          this.path = [];
          _.forEach(this.querySelectorAll('paper-checkbox'), (cb) => cb.removeAttribute('checked'));

          this.set('currentGroup', 'root');
          this.set('currentPage', 0);
        }
      });
    })();
  </script>

</dom-module>